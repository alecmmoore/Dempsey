soccerStats.directive("playerModal",function(e,r,t,a,o,s,n,c){return{restrict:"E",templateUrl:"./templates/directives/player-modal.html",controller:function(e){var r="playerModal";e.closeModal=function(){o.closeModal(r)},e.update=!1,e.states=c.states,e.$on(n.messages.updatePlayer,function(r,a){console.log(a),t(function(){a.state?(e.update=!0,e.players=c.getPlayers(function(r){console.log(r);var t=_.find(e.teamDict,function(e){return e.id==r[0].team.id});console.log(t),e.player={photo:r[0].photo?r[0].photo._url:"./img/team-logo-icon.svg",name:r[0].name,birthday:r[0].birthday,team:t,jerseyNumber:r[0].jerseyNumber,city:r[0].city,state:e.states[r[0].state],emergencyContact:{name:r[0].contact.emergencyContact,phone:r[0].contact.phone,relationship:r[0].contact.relationship},newPhoto:"",id:r[0].id}})):(e.update=!1,console.log("add player"),e.player={photo:"./img/team-logo-icon.svg",name:"Zlatan",birthday:"",team:"",jerseyNumber:"12",city:"Spokane",state:"",emergencyContact:{name:"Alec Moore",phone:"5093336897",relationship:"Father"},newPhoto:"",id:""})})}),e.goToPage=function(e){t(function(){o.goToPage(e)})},e.registerPlayer=function(r){if(e.update)e.updatePlayer(r);else if(o.validateAreaByFormName("playerForm")){var t=Parse.User.current(),c=Parse.Object.extend("Players"),l=new c,i=Parse.Object.extend("Team"),d=new Parse.Query(i);d.get(r.team.id,{success:function(o){r.newPhoto&&l.set("photo",r.newPhoto),l.set("name",r.name),l.set("birthday",r.birthday),l.set("team",o),l.set("jerseyNumber",r.jerseyNumber),l.set("city",r.city),l.set("state",_.invert(e.states)[r.state]),l.set("emergencyContact",r.emergencyContact.name),l.set("phone",r.emergencyContact.phone),l.set("relationship",r.emergencyContact.relationship),l.save(null,{success:function(o){t.addUnique("players",o),t.save(null,{success:function(){s.success("Player, "+r.name+", successfully added.");var t=Parse.Object.extend("SeasonPlayerStats"),n=new t;n.set("player",o),n.save(null,{success:function(){e.closeModal(),a.reload(),console.log("player stats saved")},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},erorr:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})}else s.error(n.toasts.requiredFields)},e.updatePlayer=function(r){var t=Parse.Object.extend("Players"),o=new Parse.Query(t);o.get(r.id,{success:function(t){var n=Parse.Object.extend("Team");o=new Parse.Query(n),o.get(r.team.id,{success:function(o){r.newPhoto&&t.set("photo",r.newPhoto),t.set("name",r.name),t.set("birthday",r.birthday),t.set("team",o),t.set("jerseyNumber",r.jerseyNumber),t.set("city",r.city),t.set("state",_.invert(e.states)[r.state]),t.set("emergencyContact",r.emergencyContact.name),t.set("phone",r.emergencyContact.phone),t.set("relationship",r.emergencyContact.relationship),t.save(null,{success:function(){s.success("Player, "+r.name+"'s profile updated."),e.closeModal(),a.reload()},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},error:function(e,r){console.log("Error: "+r.code+" "+r.message),s.error("There was a an error ("+r.code+"). Please try again.")}})},e.states=c.states,Parse.User.current()&&(e.teamDict=c.getTeams(function(){}))}}});