soccerStats.directive("playerModal",function(e,t,r,a,s,o,n,c){return{restrict:"E",templateUrl:"./templates/directives/player-modal.html",controller:function(e){var a="playerModal";e.closeModal=function(){s.closeModal(a)},e.update=!1,e.states=c.states,e.$on(n.messages.updatePlayer,function(t,a){r(function(){a.state?(e.update=!0,e.players=c.getPlayerByPlayerId(a.id,function(t){var r=_.find(e.teamDict,function(e){return e.id==t.get("team").id});e.player={photo:t.get("photo")?t.get("photo")._url:"./img/team-logo-icon.svg",name:t.get("name"),birthday:t.get("birthday"),team:r,jerseyNumber:t.get("jerseyNumber"),city:t.get("city"),state:e.states[t.get("state")],emergencyContact:{name:t.get("emergencyContact"),phone:t.get("phone"),relationship:t.get("relationship")},newPhoto:"",id:t.id}})):(e.update=!1,console.log("add player"),e.player={photo:"./img/team-logo-icon.svg",name:"Zlatan",birthday:"",team:"",jerseyNumber:"12",city:"Spokane",state:"",emergencyContact:{name:"Alec Moore",phone:"5093336897",relationship:"Father"},newPhoto:"",id:""})})}),e.goToPage=function(e){r(function(){s.goToPage(e)})},e.registerPlayer=function(r){if(e.update)e.updatePlayer(r);else if(s.validateAreaByFormName("playerForm")){var a=Parse.User.current(),c=Parse.Object.extend("Players"),i=new c,l=Parse.Object.extend("Team"),d=Parse.Object.extend("SeasonPlayerStats"),y=new d,m=new Parse.Query(l);m.get(r.team.id,{success:function(s){r.newPhoto&&i.set("photo",r.newPhoto),i.set("name",r.name),i.set("birthday",r.birthday),i.set("team",s),i.set("jerseyNumber",r.jerseyNumber),i.set("city",r.city),i.set("state",_.invert(e.states)[r.state]),i.set("emergencyContact",r.emergencyContact.name),i.set("phone",r.emergencyContact.phone),i.set("relationship",r.emergencyContact.relationship),i.set("playerStats",y),i.save(null,{success:function(s){a.addUnique("players",s),a.save(null,{success:function(){o.success("Player, "+r.name+", successfully added."),t.$broadcast(n.messages.playerAdded,s),e.closeModal()},erorr:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})}else o.error(n.toasts.requiredFields)},e.updatePlayer=function(r){var a=Parse.Object.extend("Players"),s=new Parse.Query(a);s.get(r.id,{success:function(a){var c=Parse.Object.extend("Team");s=new Parse.Query(c),s.get(r.team.id,{success:function(s){r.newPhoto&&a.set("photo",r.newPhoto),a.set("name",r.name),a.set("birthday",r.birthday),a.set("team",s),a.set("jerseyNumber",r.jerseyNumber),a.set("city",r.city),a.set("state",_.invert(e.states)[r.state]),a.set("emergencyContact",r.emergencyContact.name),a.set("phone",r.emergencyContact.phone),a.set("relationship",r.emergencyContact.relationship),a.save(null,{success:function(){o.success("Player "+r.name+"'s profile updated."),t.$broadcast(n.messages.teamChanged,{refresh:!0}),e.closeModal()},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),o.error("There was a an error ("+t.code+"). Please try again.")}})},e.states=c.states,Parse.User.current()&&(e.teamDict=c.getTeams(function(){}))}}});