soccerStats.factory("dataService",function(e,t,a,s,r,o,n){var c={U12:"U12",U16:"U16",U18:"U18",U20:"U20",U23:"U23"},i={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},l=function(){return Parse.User.current()},u={},m=Parse.Object.extend("Players"),d=Parse.Object.extend("_User"),g=Parse.Object.extend("Team"),y=Parse.Object.extend("SeasonPlayerStats"),f=Parse.Object.extend("Game"),h=Parse.Object.extend("SeasonTeamStats"),p=function(e){u=e},P=function(){return u},b=function(e){var a=[],s=new Parse.Query(d),o=Parse.User.current();return s.include("teams"),s.get(o.id,{success:function(s){t(function(){var t=s.get("teams");_.each(t,function(e){a.push(e)}),e(a)})},error:function(e,t){r.error("There was an error ("+t.code+"). Please try again.")}}),a},w=function(e){var a=[],s=Parse.User.current(),r=new Parse.Query(d);return r.include("players"),r.get(s.id,{success:function(s){t(function(){var t=s.get("players");_.each(t,function(e){var t=e.get("photo"),s=e.get("name"),r=e.get("birthday"),o=e.get("team"),n=e.get("jerseyNumber"),c=e.get("city"),i=e.get("state"),l={emergencyContact:e.get("emergencyContact"),phone:e.get("phone"),relationship:e.get("relationship")};a.push({photo:t,name:s,birthday:r,team:o,jerseyNumber:n,city:c,state:i,contact:l,id:e.id})}),e(a)})},error:function(){}}),a},T=function(e,t){var a=new g,s=new Parse.Query(f);a.id=e.id,a.fetch().then(function(e){s.equalTo("team",e),s.include("gameTeamStats"),s.find().then(function(a){for(var s,r=[],o=0;o<a.length;o++)s={id:a[o].id,date:a[o].get("date"),opponent:{name:a[o].get("opponent"),symbol:a[o].get("opponentSymbol"),score:a[o].get("gameTeamStats").get("goalsTaken")},team:{name:e.get("name"),symbol:e.get("symbol"),score:a[o].get("gameTeamStats").get("goalsMade")},status:a[o].get("status"),notes:a[o].get("gameNotes")},r.push(s);t(r)},function(e){console.log("Error: "+e.code+" "+e.message),r.error("There was a an error ("+e.code+"). Please try again.")})})},v=function(e,t){var a=new Parse.Query(g);a.include("teamStats"),a.include("teamStats.topAssists"),a.include("teamStats.topAssists.playerStats"),a.include("teamStats.topGoals"),a.include("teamStats.topGoals.playerStats"),a.include("teamStats.topShots"),a.include("teamStats.topShots.playerStats"),a.equalTo("objectId",e),a.first().then(function(e){e.get("teamStats").get("topAssists")&&e.get("teamStats").get("topAssists").slice(0,4),e.get("teamStats").get("topGoals")&&e.get("teamStats").get("topGoals").slice(0,4),e.get("teamStats").get("topShots")&&e.get("teamStats").get("topShots").slice(0,4),t(e.get("teamStats"))},function(e){console.log("Error: "+e.code+" "+e.message),t({error:"Someting happened"})})},S=function(e){var t=new g;return t.set("ageGroup",e.ageGroup),t.set("city",e.city),t.set("leagueName",e.leagueName),t.set("name",e.name),t.set("number",e.number),t.set("state",_.invert(i)[e.state]),t.set("logo",e.logo),t.set("primaryColor",e.primaryColor),t.set("teamStats",new h),t},N=function(e,t,a){t.save(null,{success:function(t){var o=new Parse.User;o.set("username",e.email),o.set("firstName",e.firstName),o.set("lastName",e.lastName),o.set("name",e.firstName+" "+e.lastName),o.set("email",e.email),o.set("password",e.password),o.set("phone",e.phone),o.set("city",e.city),o.set("state",_.invert(i)[e.state]),o.set("photo",e.photo),o.addUnique("teams",t),o.set("accountType",1),o.signUp(null,{success:function(e){r.success(s.toasts.registrationSuccess),L(e,t.id,t.get("name"),a),n.goToPage("/home")},error:function(e,t){console.log("Error: "+t.code+" "+t.message),202===t.code&&r.error(t.message)}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},I=function(e,t,o){var c=l(),u=new m,d=new y,f=new Parse.Query(g);f.get(e.team.id,{success:function(l){o?(u.set("name",e.name),u.set("jerseyNumber",e.jerseyNumber),u.set("team",l),u.set("playerStats",d)):(e.newPhoto&&u.set("photo",e.newPhoto),u.set("name",e.name),u.set("birthday",e.birthday),u.set("team",l),u.set("jerseyNumber",e.jerseyNumber),u.set("city",e.city),u.set("state",_.invert(i)[e.state]),u.set("emergencyContact",e.emergencyContact.name),u.set("phone",e.emergencyContact.phone),u.set("relationship",e.emergencyContact.relationship),u.set("playerStats",d)),u.save(null,{success:function(o){e.parentId?Parse.Cloud.run("addPlayer",{newPlayerId:o.id,parentId:e.parentId},{success:function(c){console.log(c),r.success("Player "+e.name+", successfully added."),a.$broadcast(s.messages.playerAdded,o),n.closeModal(t)},error:function(e){console.log("Error: "+e.code+" "+e.message),r.error("There was an error ("+e.code+"). Please try again.")}}):(c.addUnique("players",o),c.save(null,{success:function(){r.success("Player "+e.name+", successfully added."),a.$broadcast(s.messages.playerAdded,o),n.closeModal(t)},erorr:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}}))},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},C=function(e,t){var o=l();e.save(null,{success:function(e){o.addUnique("teams",e),o.save(null,{success:function(){r.success(s.toasts.teamAddSuccess),n.closeModal(t),a.$broadcast(s.messages.addNewTeam,e),a.$broadcast(s.messages.teamChanged,{team:e,refresh:!1})},error:function(e,t){r.error("There was a an error ("+t.code+"). Please try again."),console.log(t.message)}})},error:function(e,t){r.error("There was a an error ("+t.code+"). Please try again."),console.log(t.message)}})},M=function(e,t){var a=l();a.set("username",e.email),a.set("firstName",e.firstName),a.set("lastName",e.lastName),a.set("name",e.firstName+" "+e.lastName),a.set("email",e.email),a.set("phone",e.phone),a.set("city",e.city),a.set("state",_.invert(i)[e.state]),e.newPhoto&&a.set("photo",e.newPhoto),""!==e.newPassword&&a.set("password",e.newPassword),a.save(null,{success:function(){r.success(s.toasts.accountUpdateSuccess),n.closeModal(t)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},A=function(e,t,a){var o=new Parse.Query(g);o.get(e,{success:function(e){e.set("leagueName",t.leagueName),e.set("ageGroup",t.ageGroup),e.set("primaryColor",t.primaryColor),e.set("city",t.city),e.set("name",t.name),e.set("number",t.number),e.set("state",_.invert(i)[t.state]),t.newLogo&&e.set("logo",t.newLogo),e.save(null,{success:function(e){p(e),r.success(s.toasts.teamUpdateSuccess),n.closeModal(a)},error:function(e,t){r.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){r.error("There was a an error ("+t.code+"). Please try again.")}})},G=function(e,t){var o=new Parse.Query(m);o.get(e.id,{success:function(c){o=new Parse.Query(g),o.get(e.team.id,{success:function(o){e.newPhoto&&c.set("photo",e.newPhoto),c.set("name",e.name),c.set("birthday",e.birthday),c.set("team",o),c.set("jerseyNumber",e.jerseyNumber),c.set("city",e.city),c.set("state",_.invert(i)[e.state]),c.set("emergencyContact",e.emergencyContact.name),c.set("phone",e.emergencyContact.phone),c.set("relationship",e.emergencyContact.relationship),c.save(null,{success:function(o){e.parentId?(E(e.id),Parse.Cloud.run("addPlayer",{newPlayerId:o.id,parentId:e.parentId},{success:function(){r.success("Player "+e.name+", successfully added."),a.$broadcast(s.messages.teamChanged,{refresh:!0}),n.closeModal(t)},error:function(e){console.log("Error: "+e.code+" "+e.message),r.error("There was an error ("+e.code+"). Please try again.")}})):(r.success("Player "+e.name+"'s profile updated."),a.$broadcast(s.messages.teamChanged,{refresh:!0}),n.closeModal(t))},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},E=function(e){Parse.Cloud.run("removePlayer",{playerId:e},{success:function(){console.log("remove player from parent successful")},error:function(e){console.log("Error: "+e.code+" "+e.message),r.error("There was an error ("+e.code+"). Please try again.")}})},j=function(e,a){var s=new Parse.Query(g);s.equalTo("objectId",e),s.first({success:function(e){t(function(){a(e)})},error:function(e,t){r.error("There was an error ("+t.code+"). Please try again.")}})},U=function(e,a){var s=new Parse.Query(m);s.equalTo("team",{__type:"Pointer",className:"Team",objectId:e}),s.find({success:function(e){t(function(){a(e)})},error:function(e,t){r.error("There was an error ("+t.code+"). Please try again.")}})},B=function(e,a){var s=new Parse.Query(y);s.equalTo("objectId",e),s.first({success:function(e){t(function(){a(e)})},error:function(e,t){r.error("There was an error ("+t.code+"). Please try again.")}})},Q=function(e,a){var s=new Parse.Query(m);s.equalTo("objectId",e),s.first({success:function(e){t(function(){a(e)})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},D=function(e,t){var a=new Parse.Query(f);a.include("gameTeamStats"),a.first(e).then(function(e){t(e)},function(e){console.log("Error: "+e.code+" "+e.message),t({})})},O=function(e,t){var a=new Parse.Query(d);a.equalTo("teams",{__type:"Pointer",className:"Team",objectId:e}),a.equalTo("accountType",2),a.find({success:function(e){t(e)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},q=function(e,t){var a=new Parse.Query(d);a.equalTo("players",{__type:"Pointer",className:"Players",objectId:e}),a.equalTo("accountType",2),a.first({success:function(e){t(e)},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},k=function(e,t){var a=new Game;a.set("date",e.date),a.set("opponent",e.opponent.name),a.set("opponentSymbol",e.opponent.symbol),a.set("startTime",e.time.toTimeString()),a.set("team",{__type:"Pointer",className:"Team",objectId:t}),a.set("gameTeamStats",new h),a.set("status","not_started"),a.save(null,{success:function(){r.success("Game on "+(e.date.getMonth()+1)+"/"+e.date.getDate()+" added.")},error:function(e,t){console.log("Error saving game: "+t.code+" "+t.message),r.error("There was an error ("+t.code+"). Please try again.")}})},x=function(e,t,a){var s=new Parse.Query(f);s.equalTo("objectId",e.id),s.first({success:function(e){console.log(e);for(var s=0;s<t.length;s++)e.set(t[s],a[s]);e.save(null,{success:function(){r.success("Successfully saved game notes.")},error:function(){r.error("There was an error.")}})},error:function(e,t){console.log("Error: "+t.code+" "+t.message),r.error("There was a an error ("+t.code+"). Please try again.")}})},W=function(e,t){var a={id:e.id,photo:e.attributes.photo?e.attributes.photo._url:"./img/player-icon.svg",fname:e.attributes.name,lname:"",number:e.attributes.jerseyNumber,position:"",total:{goals:t.attributes.goals?t.attributes.goals:0,fouls:t.attributes.fouls?t.attributes.fouls:0,playingTime:t.attributes.playingTime?Math.round(t.attributes.playingTime):0,assists:t.attributes.assists?t.attributes.assists:0,yellows:0,reds:0,cardInit:function(e,t){_.each(t.attributes.cards,function(t){"yellow"===t.type?e.yellows++:"red"===t.type&&e.reds++})}},shots:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Missed"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Completed"}],accuracy:0,blocks:0,onGoal:0,offGoal:0,goals:0,shotInit:function(e,t){_.each(t.attributes.shots,function(t){e.blocks+=t.blocked,e.onGoal+=t.onGoal,e.offGoal+=t.offGoal,e.goals+=t.goals});var a=e.blocks+e.onGoal+e.offGoal+e.goals;e.accuracy=Math.round((a-e.offGoal)/a*100),e.data[0].value=e.offGoal,e.data[1].value=a}},passes:{data:[{value:0,color:"#B4B4B4",highlight:"#B4B4B4",label:"Turnovers"},{value:0,color:"#5DA97B",highlight:"#5DA97B",label:"Total Passes"}],completion:"0/0",turnovers:0,total:0,passInit:function(e,t){_.each(t.attributes.passes,function(t){e.turnovers+=t.turnovers,e.total+=t.total}),e.completion=e.total-e.turnovers+"/"+e.total,e.data[0].value=e.turnovers,e.data[1].value=e.total}},phone:"(123) 456 7890",emergencyContact:{name:e.attributes.emergencyContact,phone:e.attributes.phone,relationship:e.attributes.relationship}};return t.attributes.cards&&a.total.cardInit(a.total,t),t.attributes.shots&&a.shots.shotInit(a.shots,t),t.attributes.passes&&a.passes.passInit(a.passes,t),a},L=function(e,t,a,s,r){_.each(s,function(s){o.sendEmailInvite(e.get("name"),t,a,s)}),n.closeModal(r)};return{ageGroups:c,states:i,getTeams:b,getTeamById:j,getPlayersByTeamId:U,setCurrentTeam:p,getCurrentTeam:P,registerTeam:S,getPlayers:w,getCurrentUser:l,getSeasonPlayerStatsByPlayerId:B,getGames:T,playerConstructor:W,getPlayerByPlayerId:Q,getSeasonTeamStats:v,saveGame:k,saveGameAttributes:x,getGameStatsById:D,registerCoach:N,sendEmailInvite:L,updateAccount:M,updateTeam:A,registerPlayer:I,updatePlayer:G,registerNewTeam:C,getParentEmailsByTeamId:O,getParentByPlayerId:q}});