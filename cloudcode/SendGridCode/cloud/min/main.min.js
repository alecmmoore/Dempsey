Parse.Cloud.define("sendEmailInvite",function(e,r){var o=require("sendgrid");o.initialize("alecm00re","$umAv3nue!");var a,t,s=e.params.coachName,n=e.params.teamId,i=e.params.teamName,c=e.params.emailTo,l=e.params.tempPassword,m=new Parse.Query("User");m.equalTo("email",c),m.find({success:function(e){if(e.length<=0){t="<p style='font-family:sans-serif;'>Hi There! <br/><br/>You have been invited to Soccer Stats by <i>"+s+"</i> with the team <b>"+i+"</b>! <br/><br/>To login, go to http://alecmmoore.github.io#/login?teamid="+n+" and use your email and temporary password to log in. You can change your password once you have already logged in.<br/><br/><br/><br/>Email: <b>"+c+"</b> <br/><br/>Temporary Password: <b>"+l+"</b><br/> <br/><br/><br/><br/>Please logon and register your player.<br/><br/>Thanks!<br/>Soccer Stats Development Team</p>";var m=new Parse.User;m.set("username",c),m.set("password",l),m.set("email",c),m.set("accountType",2),m.signUp(null,{success:function(){a=o.Email({to:c}),a.setFrom("no-reply@soccerstats.com"),a.setFromName("Soccer Stats"),a.setSubject("Welcome to Soccer Stats!"),a.setHTML(t),o.sendEmail(a).then(function(e){console.log(e),r.success("Email sent!")},function(e){console.error(e),r.error(e)})},error:function(e,r){console.log("Error: "+r.code+" "+r.message)}})}else t="<p style='font-family:sans-serif;'>Hi There! <br/><br/>You have been invited to Soccer Stats by <i>"+s+"</i> with the team <b>"+i+"</b>! <br/><br/>Looks like you already have an account with us, so go ahead and log in at http://alecmmoore.github.io#/login to accept the invitation.<br/><br/><br/><br/>Please logon and register your playerThanks!<br/>Soccer Stats Development Team</p>",a=o.Email({to:c}),a.setFrom("no-reply@soccerstats.com"),a.setFromName("Soccer Stats"),a.setSubject("Welcome to Soccer Stats!"),a.setHTML(t),o.sendEmail(a).then(function(e){console.log(e),r.success("Email sent!")},function(e){console.error(e),r.error(e)})},error:function(){r.error("User lookup failed")}})});